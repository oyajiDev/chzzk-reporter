const schedule=require("node-schedule"),{exec:exec}=require("child_process"),configs=require("../../configs.json"),utils=require("../../src/utils.js"),client=require("../../src/connection.js").connect(configs.nidAuth,configs.nidSession);function enableApplyButton(){document.querySelector("#btn_apply").removeAttribute("disabled")}function toggleDivideByCategory(e){document.querySelector("#inp_divide_true").checked=e,document.querySelector("#inp_divide_false").checked=!e,enableApplyButton()}function toggleCreateFilter(e){document.querySelector("#inp_filter_true").checked=e,document.querySelector("#inp_filter_false").checked=!e,enableApplyButton()}function toggleOpenReport(e){document.querySelector("#inp_openReport_true").checked=e,document.querySelector("#inp_openReport_false").checked=!e,enableApplyButton()}function applyConfigs(){configs.interval=parseInt(document.querySelector("#inp_interval").value),configs.reportDir=utils.reportDir(document.querySelector("#inp_reportDir").value),configs.keywords=document.querySelector("#inp_keywords").value.split(",").map((e=>e.trim())),configs.divideByCategory=document.querySelector("#inp_divide_true").checked,configs.createFilter=document.querySelector("#inp_filter_true").checked,configs.openReport=document.querySelector("#inp_openReport_true").checked,schedule.gracefulShutdown().then((()=>{schedule.scheduleJob(`0 0 */${configs.interval} * * *`,$showReport),document.querySelector("#btn_apply").setAttribute("disabled","")}))}async function $showReport(){console.log(configs),require("../../src/reporter.js").report(await utils.getLivesByKeywords(client,configs.keywords,!0),configs.reportDir,configs.divideByCategory,configs.createFilter,configs.openReport)}window.addEventListener("DOMContentLoaded",(()=>{document.querySelector("#inp_interval").value=configs.interval??1,document.querySelector("#inp_reportDir").value=configs.reportDir??"./reports",document.querySelector("#inp_keywords").value=(configs.keywords??["talk"]).join(","),toggleDivideByCategory(configs.divideByCategory??!1),toggleCreateFilter(configs.createFilter??!1),toggleOpenReport(configs.openReport??!1),applyConfigs()}));